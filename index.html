<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>POSÊî∂ÈäÄÁ≥ªÁµ±-ÈÄ≤Èöé‰∫íÂãï(ÂèØÁ∑®ËºØÁî¢ÂìÅ/Â§ö‰ªòÊ¨æ/Ë™ûÈü≥ÈñãÈóú)</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {font-family: 'Microsoft JhengHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh; padding: 20px;}
        .pos-container {max-width: 1400px; margin: 0 auto; background: white; border-radius: 20px; box-shadow: 0 20px 40px rgba(0,0,0,0.1); overflow: hidden;}
        .header {background: linear-gradient(45deg, #2c3e50, #34495e); color: white; padding: 20px 30px; display: flex; justify-content: space-between; align-items: center;}
        .logo { font-size: 24px; font-weight: bold;}
        .datetime { font-size: 14px; opacity: 0.9;}
        .main-content { display: grid; grid-template-columns: 2fr 1fr; gap: 0; min-height: 80vh;}
        .left-panel { padding: 30px; background: #f8f9fa;}
        .right-panel { background: white; border-left: 1px solid #e0e0e0; display: flex; flex-direction: column;}
        .products-section h2 { color: #2c3e50; margin-bottom: 20px; font-size: 20px;}
        .product-categories { display: flex; gap: 10px; margin-bottom: 20px;}
        .category-btn { padding: 8px 16px; border: 2px solid #3498db; background: white; color: #3498db; border-radius: 25px; cursor: pointer; transition: all 0.3s; font-size: 14px;}
        .category-btn.active, .category-btn:hover { background: #3498db; color: white;}
        .product-search-box { margin-bottom: 15px;}
        .product-search-box input { width: 70%; padding: 8px 12px; border: 1.5px solid #bbb; border-radius: 20px; font-size: 15px; outline: none; transition: border 0.2s;}
        .product-search-box input:focus { border: 1.5px solid #3498db;}
        .products-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px;}
        .product-card { background: white; border-radius: 15px; padding: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); position: relative; transition: all 0.3s; border: 2px solid transparent;}
        .product-card:hover { transform: translateY(-5px); box-shadow: 0 10px 25px rgba(0,0,0,0.15); border-color: #3498db;}
        .product-name { font-weight: bold; color: #2c3e50; margin-bottom: 8px; font-size: 16px;}
        .product-price { color: #e74c3c; font-size: 18px; font-weight: bold; margin-bottom: 8px;}
        .product-stock { font-size: 12px; color: #7f8c8d;}
        .stock-low { color: #e74c3c;}
        .stock-out { color: #c0392b; font-weight: bold;}
        .product-actions { position: absolute; top: 8px; right: 8px; display: flex; gap: 4px;}
        .edit-btn, .del-btn { background: #fff; border: 1px solid #bbb; border-radius: 5px; padding: 2px 8px; font-size: 13px; cursor: pointer;}
        .edit-btn:hover { background: #f1c40f; color: #fff; border-color: #f1c40f;}
        .del-btn:hover { background: #e74c3c; color: #fff; border-color: #e74c3c;}
        .add-product-btn { margin-bottom: 18px; background: #27ae60; color: #fff; border: none; border-radius: 20px; padding: 8px 24px; cursor: pointer; font-size: 16px;}
        .add-product-btn:hover { background: #219150;}
        .cart-section { padding: 30px; flex: 1;}
        .cart-header { display: flex; align-items: center; gap: 10px; margin-bottom: 20px; color: #2c3e50;}
        .cart-items { max-height: 300px; overflow-y: auto; margin-bottom: 20px;}
        .cart-item { display: flex; justify-content: space-between; align-items: center; padding: 15px; border: 1px solid #ecf0f1; border-radius: 10px; margin-bottom: 10px; background: #f8f9fa; cursor: grab;}
        .cart-item.dragging { opacity: 0.4;}
        .item-info { flex: 1; cursor: grab;}
        .item-name { font-weight: bold; color: #2c3e50;}
        .item-price { color: #7f8c8d; font-size: 14px;}
        .quantity-controls { display: flex; align-items: center; gap: 10px;}
        .qty-btn { width: 30px; height: 30px; border: none; background: #3498db; color: white; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center;}
        .qty-btn:hover { background: #2980b9;}
        .quantity { font-weight: bold; min-width: 30px; text-align: center;}
        .remove-btn { background: #e74c3c; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer;}
        .remove-btn:hover { background: #c0392b;}
        .subtotal-section { padding: 20px 30px; border-top: 2px solid #ecf0f1; background: #f8f9fa;}
        .subtotal-row { display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 16px;}
        .total-row { display: flex; justify-content: space-between; font-size: 20px; font-weight: bold; color: #2c3e50; border-top: 2px solid #bdc3c7; padding-top: 10px; margin-top: 10px;}
        .discount-applied { color: #27ae60;}
        .member-section { padding: 20px 30px; border-top: 2px solid #ecf0f1; background: white;}
        .member-card { background: linear-gradient(45deg, #f39c12, #e67e22); color: white; padding: 20px; border-radius: 15px; margin-bottom: 15px;}
        .member-info { display: flex; justify-content: space-between; align-items: center;}
        .member-name { font-size: 18px; font-weight: bold;}
        .member-level { background: rgba(255,255,255,0.2); padding: 5px 10px; border-radius: 15px; font-size: 12px;}
        .member-details { margin-top: 10px; font-size: 14px; opacity: 0.9;}
        .member-login { text-align: center; color: #7f8c8d; padding: 20px;}
        .login-btn { background: #3498db; color: white; border: none; padding: 10px 20px; border-radius: 25px; cursor: pointer; margin-top: 10px;}
        .login-btn:hover { background: #2980b9;}
        .promotions-section { padding: 20px 30px; border-top: 2px solid #ecf0f1; background: #f8f9fa;}
        .promotion-item { background: linear-gradient(45deg, #e74c3c, #c0392b); color: white; padding: 15px; border-radius: 10px; margin-bottom: 10px; animation: pulse 2s infinite;}
        .promotion-title { font-weight: bold; margin-bottom: 5px;}
        .promotion-desc { font-size: 12px; opacity: 0.9;}
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(231, 76, 60, 0.7);} 70% { box-shadow: 0 0 0 10px rgba(231, 76, 60, 0);} 100% { box-shadow: 0 0 0 0 rgba(231, 76, 60, 0);}}
        .checkout-section { padding: 20px 30px; background: white;}
        .checkout-btn { width: 100%; background: linear-gradient(45deg, #27ae60, #2ecc71); color: white; border: none; padding: 15px; font-size: 18px; font-weight: bold; border-radius: 10px; cursor: pointer; transition: all 0.3s;}
        .checkout-btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(39, 174, 96, 0.3);}
        .checkout-btn:disabled { background: #bdc3c7; cursor: not-allowed; transform: none; box-shadow: none;}
        .empty-cart { text-align: center; color: #7f8c8d; padding: 40px 20px;}
        .empty-cart-icon { font-size: 48px; margin-bottom: 15px; opacity: 0.5;}
        /* ‰ªòÊ¨æÊñπÂºèÊåâÈàï */
        .payment-methods { display: flex; gap: 10px; margin: 15px 0;}
        .pay-method-btn { padding: 8px 16px; border-radius: 18px; border: 2px solid #34495e; background: white; color: #34495e; cursor: pointer; font-size: 15px;}
        .pay-method-btn.active, .pay-method-btn:hover { background: #34495e; color: #fff;}
        /* ÂàóÂç∞Â∞àÁî®Ê®£Âºè */
        @media print { body * { visibility: hidden !important;} #print-area, #print-area * { visibility: visible !important;} #print-area { position: absolute; left: 0; top: 0; width: 100vw; background: white;}}
        /* Modal */
        .modal-bg { position: fixed; left: 0; top: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.3); display: flex; justify-content: center; align-items: center; z-index: 99;}
        .modal { background: #fff; border-radius: 12px; padding: 24px; min-width: 340px; box-shadow: 0 8px 32px rgba(0,0,0,0.21);}
        .modal label { display: block; margin-bottom: 5px;}
        .modal input, .modal select { width: 100%; padding: 8px 10px; margin-bottom: 14px; border: 1.2px solid #bbb; border-radius: 6px;}
        .modal-actions { text-align: right;}
        .modal-actions button { margin-left: 10px; padding: 7px 18px; border-radius: 8px; border: none; font-size: 15px;}
        .modal-actions .cancel-btn { background: #bdc3c7; color: #fff;}
        .modal-actions .ok-btn { background: #27ae60; color: #fff;}
        /* Ë™ûÈü≥ÈñãÈóú */
        .speech-toggle { position: absolute; right: 35px; top: 20px; z-index: 10;}
        .speech-toggle label { font-size: 15px; color: #fff; background: #27ae60; border-radius: 12px; padding: 3px 14px; cursor: pointer;}
        .speech-toggle input[type="checkbox"] { margin-right: 5px;}
        @media (max-width: 768px) { .main-content { grid-template-columns: 1fr;} .products-grid { grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));} .pos-container { margin: 10px; border-radius: 10px;}}
    </style>
</head>
<body>
    <div class="pos-container">
        <div class="header">
            <div class="logo">üè™ POSÊî∂ÈäÄÁ≥ªÁµ±</div>
            <div class="speech-toggle">
                <label><input type="checkbox" id="speechSwitch" checked>Ë™ûÈü≥ÊèêÁ§∫</label>
            </div>
            <div class="datetime" id="datetime"></div>
        </div>
        <div class="main-content">
            <!-- Â∑¶ÂÅ¥ÔºöÁî¢ÂìÅÈÅ∏ÊìáÂçÄÂüü -->
            <div class="left-panel">
                <div class="products-section">
                    <h2>üì¶ Áî¢ÂìÅÈÅ∏Êìá</h2>
                    <button class="add-product-btn" onclick="showProductModal()">Ôºã Êñ∞Â¢ûÂïÜÂìÅ</button>
                    <div class="product-categories">
                        <button class="category-btn active" onclick="filterProducts('all', event)">ÂÖ®ÈÉ®</button>
                        <button class="category-btn" onclick="filterProducts('È£≤ÂìÅ', event)">È£≤ÂìÅ</button>
                        <button class="category-btn" onclick="filterProducts('ÁîúÈªû', event)">ÁîúÈªû</button>
                        <button class="category-btn" onclick="filterProducts('‰∏ªÈ£ü', event)">‰∏ªÈ£ü</button>
                        <button class="category-btn" onclick="filterProducts('Â∞èÈ£ü', event)">Â∞èÈ£ü</button>
                    </div>
                    <div class="product-search-box">
                        <input type="text" id="barcodeInput" placeholder="Ë´ãÊéÉÊ¢ùÁ¢ºÊàñËº∏ÂÖ•ÂïÜÂìÅÈóúÈçµÂ≠ó">
                    </div>
                    <div class="products-grid" id="productsGrid"></div>
                </div>
            </div>
            <!-- Âè≥ÂÅ¥ÔºöË≥ºÁâ©ËªäÂíåÂÖ∂‰ªñË≥áË®ä -->
            <div class="right-panel">
                <div class="cart-section">
                    <div class="cart-header">
                        <span>üõí</span>
                        <h3>Ë≥ºÁâ©Ëªä</h3>
                        <span id="cartCount">(0)</span>
                    </div>
                    <div class="cart-items" id="cartItems"></div>
                </div>
                <div class="subtotal-section">
                    <div class="subtotal-row">
                        <span>Â∞èË®àÔºö</span>
                        <span id="subtotal">NT$0</span>
                    </div>
                    <div class="subtotal-row">
                        <span>ÊäòÊâ£Ôºö</span>
                        <span id="discount" class="discount-applied">-NT$0</span>
                    </div>
                    <div class="subtotal-row">
                        <span>Á®ÖÈáëÔºö</span>
                        <span id="tax">NT$0</span>
                    </div>
                    <div class="total-row">
                        <span>Á∏ΩË®àÔºö</span>
                        <span id="total">NT$0</span>
                    </div>
                </div>
                <div class="payment-methods">
                    <button class="pay-method-btn active" onclick="selectPayment('ÁèæÈáë', this)">ÁèæÈáë</button>
                    <button class="pay-method-btn" onclick="selectPayment('Á¶ÆÂà∏', this)">Á¶ÆÂà∏</button>
                    <button class="pay-method-btn" onclick="selectPayment('‰ø°Áî®Âç°', this)">‰ø°Áî®Âç°</button>
                </div>
                <div class="member-section">
                    <h4>üë§ ÊúÉÂì°Ë≥áË®ä</h4>
                    <div id="memberInfo">
                        <div class="member-login">
                            <p>Â∞öÊú™ÁôªÂÖ•ÊúÉÂì°</p>
                            <button class="login-btn" onclick="loginMember()">ÊúÉÂì°ÁôªÂÖ•</button>
                        </div>
                    </div>
                </div>
                <div class="promotions-section">
                    <h4>üéâ ÂÑ™ÊÉ†Ê¥ªÂãï</h4>
                    <div id="promotions"></div>
                </div>
                <div class="checkout-section">
                    <button class="checkout-btn" id="checkoutBtn" onclick="checkout()" disabled>üí≥ ÁµêÂ∏≥‰ªòÊ¨æ</button>
                    <button class="checkout-btn" style="margin-top:10px;background:#34495e;" onclick="printReceipt()">üñ®Ô∏è ÂàóÂç∞ÊòéÁ¥∞</button>
                </div>
            </div>
        </div>
    </div>
    <div id="print-area" style="display:none;">
        <h2>POS Ë≥ºÁâ©ÊòéÁ¥∞</h2>
        <div id="print-cart-list"></div>
        <div id="print-total"></div>
        <p style="margin-top:20px;">ÊÑüË¨ùÊÇ®ÁöÑÊ∂àË≤ªÔºÅ</p>
    </div>
    <!-- Modal -->
    <div id="modalBg" class="modal-bg" style="display:none;">
        <div id="modal" class="modal"></div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.2/Sortable.min.js"></script>
    <script>
        // Áî¢ÂìÅÊï∏Êìö
        let products = [
            { id: 1, name: 'Á∂ìÂÖ∏ÁæéÂºèÂíñÂï°', price: 120, stock: 25, category: 'È£≤ÂìÅ' },
            { id: 2, name: 'ÊãøÈêµÂíñÂï°', price: 150, stock: 18, category: 'È£≤ÂìÅ' },
            { id: 3, name: 'Âç°Â∏ÉÂ•áË´æ', price: 140, stock: 20, category: 'È£≤ÂìÅ' },
            { id: 4, name: 'Â∑ßÂÖãÂäõËõãÁ≥ï', price: 180, stock: 8, category: 'ÁîúÈªû' },
            { id: 5, name: 'Ëµ∑Âè∏ËõãÁ≥ï', price: 200, stock: 5, category: 'ÁîúÈªû' },
            { id: 6, name: 'ÊèêÊãâÁ±≥Ëòá', price: 220, stock: 3, category: 'ÁîúÈªû' },
            { id: 7, name: 'Á∂ìÂÖ∏Êº¢Â†°', price: 280, stock: 12, category: '‰∏ªÈ£ü' },
            { id: 8, name: 'ÁÇ∏ÈõûÂ•óÈ§ê', price: 320, stock: 15, category: '‰∏ªÈ£ü' },
            { id: 9, name: 'Áæ©Â§ßÂà©È∫µ', price: 250, stock: 10, category: '‰∏ªÈ£ü' },
            { id: 10, name: 'ËñØÊ¢ù', price: 80, stock: 30, category: 'Â∞èÈ£ü' },
            { id: 11, name: 'Ê¥ãËî•Âúà', price: 90, stock: 20, category: 'Â∞èÈ£ü' },
            { id: 12, name: 'ÈõûÂ°ä', price: 100, stock: 25, category: 'Â∞èÈ£ü' }
        ];
        let cart = [];
        let currentMember = null;
        let currentProductFilter = 'all';
        let currentSearch = '';
        let paymentMethod = 'ÁèæÈáë';
        let speechOn = true;
        let editingProductId = null;
        const memberData = {
            id: 'M001',
            name: 'ÁéãÂ∞èÊòé',
            phone: '0912-345-678',
            points: 1250,
            level: 'VIP',
            discount: 0.1
        };
        const promotions = [
            { id: 1, title: 'Êªø500ÈÄÅ50', description: 'Ê∂àË≤ªÊªø500ÂÖÉÂç≥ÈÄÅ50ÂÖÉÊäòÂÉπÂà∏', active: true },
            { id: 2, title: 'VIPÊúÉÂì°9Êäò', description: 'VIPÊúÉÂì°‰∫´ÂÖ®ÂìÅÈ†Ö9ÊäòÂÑ™ÊÉ†', active: true },
            { id: 3, title: 'Ë≤∑‰∫åÈÄÅ‰∏Ä', description: 'È£≤ÂìÅË≤∑‰∫åÈÄÅ‰∏ÄÔºàÈôêÈÄ±Êú´Ôºâ', active: false }
        ];
        document.addEventListener('DOMContentLoaded', function() {
            updateDateTime();
            setInterval(updateDateTime, 1000);
            renderProducts();
            renderPromotions();
            updateCartDisplay();
            document.getElementById('barcodeInput').addEventListener('input', function(e){
                currentSearch = e.target.value.trim();
                renderProducts(currentProductFilter, currentSearch);
            });
            new Sortable(document.getElementById('cartItems'), {
                animation: 150,
                handle: '.item-info',
                onEnd: function (evt) {
                    const newOrder = Array.from(document.querySelectorAll('#cartItems .cart-item')).map(el => Number(el.dataset.id));
                    cart = newOrder.map(id => cart.find(item => item.id === id));
                    updateCartDisplay();
                    speak('Ë≥ºÁâ©ËªäÂ∑≤ÈáçÊñ∞ÊéíÂ∫è');
                }
            });
            document.getElementById('speechSwitch').addEventListener('change', function(e){
                speechOn = e.target.checked;
            });
        });
        function updateDateTime() {
            const now = new Date();
            const dateTimeString = now.toLocaleDateString('zh-TW') + ' ' + now.toLocaleTimeString('zh-TW');
            document.getElementById('datetime').textContent = dateTimeString;
        }
        function renderProducts(filter = 'all', search = '') {
            currentProductFilter = filter;
            const grid = document.getElementById('productsGrid');
            let filteredProducts = products;
            if (filter && filter !== 'all') filteredProducts = filteredProducts.filter(p => p.category === filter);
            if (search) filteredProducts = filteredProducts.filter(p => p.name.includes(search));
            grid.innerHTML = filteredProducts.map(product => `
                <div class="product-card">
                    <div class="product-actions">
                        <button class="edit-btn" onclick="event.stopPropagation(); editProduct(${product.id})">Á∑®ËºØ</button>
                        <button class="del-btn" onclick="event.stopPropagation(); delProduct(${product.id})">Âà™Èô§</button>
                    </div>
                    <div onclick="addToCart(${product.id})">
                        <div class="product-name">${product.name}</div>
                        <div class="product-price">NT$${product.price}</div>
                        <div class="product-stock ${getStockClass(product.stock)}">
                            Â∫´Â≠òÔºö${product.stock}‰ª∂
                            ${product.stock <= 5 ? '‚ö†Ô∏è' : ''}
                            ${product.stock === 0 ? '‚ùå' : ''}
                        </div>
                    </div>
                </div>
            `).join('');
        }
        function getStockClass(stock) {
            if (stock === 0) return 'stock-out';
            if (stock <= 5) return 'stock-low';
            return '';
        }
        function filterProducts(category, event) {
            document.querySelectorAll('.category-btn').forEach(btn => btn.classList.remove('active'));
            if (event) event.target.classList.add('active');
            renderProducts(category, document.getElementById('barcodeInput').value.trim());
        }
        function addToCart(productId) {
            const product = products.find(p => p.id === productId);
            if (!product || product.stock <= 0) return;
            const existingItem = cart.find(item => item.id === productId);
            if (existingItem) {
                if (existingItem.quantity < product.stock) {
                    existingItem.quantity++;
                }
            } else {
                cart.push({...product, quantity: 1});
            }
            updateCartDisplay();
            renderProducts();
            speak(`${product.name} Â∑≤Âä†ÂÖ•Ë≥ºÁâ©Ëªä`);
        }
        function updateCartDisplay() {
            const cartItems = document.getElementById('cartItems');
            const cartCount = document.getElementById('cartCount');
            if (cart.length === 0) {
                cartItems.innerHTML = `
                    <div class="empty-cart">
                        <div class="empty-cart-icon">üõí</div>
                        <p>Ë≥ºÁâ©ËªäÊòØÁ©∫ÁöÑ</p>
                        <p>Ë´ãÈÅ∏ÊìáÂïÜÂìÅÂä†ÂÖ•Ë≥ºÁâ©Ëªä</p>
                    </div>
                `;
                cartCount.textContent = '(0)';
            } else {
                cartItems.innerHTML = cart.map(item => `
                    <div class="cart-item" data-id="${item.id}">
                        <div class="item-info">
                            <div class="item-name">${item.name}</div>
                            <div class="item-price">NT$${item.price} x ${item.quantity}</div>
                        </div>
                        <div class="quantity-controls">
                            <button class="qty-btn" onclick="updateQuantity(${item.id}, -1)">-</button>
                            <span class="quantity">${item.quantity}</span>
                            <button class="qty-btn" onclick="updateQuantity(${item.id}, 1)">+</button>
                            <button class="remove-btn" onclick="removeFromCart(${item.id})">üóëÔ∏è</button>
                        </div>
                    </div>
                `).join('');
                const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
                cartCount.textContent = `(${totalItems})`;
            }
            updateSubtotal();
        }
        function updateQuantity(productId, change) {
            const item = cart.find(item => item.id === productId);
            const product = products.find(p => p.id === productId);
            if (item) {
                const newQuantity = item.quantity + change;
                if (newQuantity <= 0) {
                    removeFromCart(productId);
                } else if (newQuantity <= product.stock) {
                    item.quantity = newQuantity;
                    updateCartDisplay();
                }
            }
        }
        function removeFromCart(productId) {
            cart = cart.filter(item => item.id !== productId);
            updateCartDisplay();
        }
        function updateSubtotal() {
            const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            let discount = 0;
            if (currentMember && currentMember.level === 'VIP') {
                discount = subtotal * currentMember.discount;
            }
            const tax = Math.round((subtotal - discount) * 0.05);
            const total = subtotal - discount + tax;
            document.getElementById('subtotal').textContent = `NT$${subtotal}`;
            document.getElementById('discount').textContent = `-NT$${Math.round(discount)}`;
            document.getElementById('tax').textContent = `NT$${tax}`;
            document.getElementById('total').textContent = `NT$${total}`;
            document.getElementById('checkoutBtn').disabled = cart.length === 0;
        }
        function loginMember() {
            currentMember = memberData;
            const memberInfo = document.getElementById('memberInfo');
            memberInfo.innerHTML = `
                <div class="member-card">
                    <div class="member-info">
                        <div>
                            <div class="member-name">${currentMember.name}</div>
                            <div class="member-details">
                                ÊâãÊ©üÔºö${currentMember.phone}<br>
                                ÈªûÊï∏Ôºö<span id="points">${currentMember.points}</span>Èªû
                            </div>
                        </div>
                        <div class="member-level">${currentMember.level}</div>
                    </div>
                </div>
                <button class="login-btn" onclick="logoutMember()">ÁôªÂá∫</button>
                <button class="login-btn" onclick="redeemPoints()">Áî® 100 ÈªûÊäòÊäµ NT$10</button>
            `;
            updateSubtotal();
        }
        function logoutMember() {
            currentMember = null;
            const memberInfo = document.getElementById('memberInfo');
            memberInfo.innerHTML = `
                <div class="member-login">
                    <p>Â∞öÊú™ÁôªÂÖ•ÊúÉÂì°</p>
                    <button class="login-btn" onclick="loginMember()">ÊúÉÂì°ÁôªÂÖ•</button>
                </div>
            `;
            updateSubtotal();
        }
        function redeemPoints() {
            if (currentMember && currentMember.points >= 100) {
                currentMember.points -= 100;
                let extraDiscount = 10;
                let subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                let discount = (currentMember.level === 'VIP') ? subtotal * currentMember.discount : 0;
                document.getElementById('discount').textContent = `-NT$${Math.round(discount)+extraDiscount}`;
                document.getElementById('points').textContent = currentMember.points;
                speak('Â∑≤‰ΩøÁî® 100 ÈªûÁ©çÂàÜÊäòÊäµ NT$10');
                const tax = Math.round((subtotal - discount - extraDiscount) * 0.05);
                const total = subtotal - discount - extraDiscount + tax;
                document.getElementById('tax').textContent = `NT$${tax}`;
                document.getElementById('total').textContent = `NT$${total}`;
            } else {
                speak('ÈªûÊï∏‰∏çË∂≥ÔºåÁÑ°Ê≥ïÊäòÊäµ');
            }
        }
        function renderPromotions() {
            const promotionsDiv = document.getElementById('promotions');
            const activePromotions = promotions.filter(p => p.active);
            if (activePromotions.length === 0) {
                promotionsDiv.innerHTML = '<p style="text-align: center; color: #7f8c8d;">Êö´ÁÑ°ÂÑ™ÊÉ†Ê¥ªÂãï</p>';
                return;
            }
            promotionsDiv.innerHTML = activePromotions.map(promo => `
                <div class="promotion-item" onclick="showPromotionDetail('${promo.title}','${promo.description}')">
                    <div class="promotion-title">${promo.title}</div>
                    <div class="promotion-desc">${promo.description}</div>
                </div>
            `).join('');
        }
        function showPromotionDetail(title, desc) {
            alert(`${title}\n\n${desc}`);
            speak(`${title} Ê¥ªÂãïË©≥ÊÉÖÂ∑≤È°ØÁ§∫`);
        }
        function selectPayment(type, btn) {
            paymentMethod = type;
            document.querySelectorAll('.pay-method-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            speak(`‰ªòÊ¨æÊñπÂºèÂ∑≤ÈÅ∏ÊìáÔºö${type}`);
        }
        function checkout() {
            if (cart.length === 0) return;
            const total = document.getElementById('total').textContent;
            const confirmed = confirm(`Á¢∫Ë™ç‰ª•„Äå${paymentMethod}„ÄçÁµêÂ∏≥Ôºü\nÁ∏ΩÈáëÈ°çÔºö${total}`);
            if (confirmed) {
                cart.forEach(item => {
                    const product = products.find(p => p.id === item.id);
                    if (product) { product.stock -= item.quantity; }
                });
                cart = [];
                updateCartDisplay();
                renderProducts();
                speak('ÁµêÂ∏≥ÂÆåÊàêÔºåÊÑüË¨ùÊÇ®ÁöÑÊ∂àË≤ª');
                alert('ÁµêÂ∏≥ÂÆåÊàêÔºÅÊÑüË¨ùÊÇ®ÁöÑÊ∂àË≤ªÔºÅ');
            }
        }
        function printReceipt() {
            if (cart.length === 0) return;
            const printCartList = document.getElementById('print-cart-list');
            printCartList.innerHTML = `
                <table style="width:100%;border-collapse:collapse;">
                    <thead>
                        <tr>
                            <th style="text-align:left;border-bottom:1px solid #bbb;">ÂïÜÂìÅ</th>
                            <th style="text-align:right;border-bottom:1px solid #bbb;">ÂñÆÂÉπ</th>
                            <th style="text-align:right;border-bottom:1px solid #bbb;">Êï∏Èáè</th>
                            <th style="text-align:right;border-bottom:1px solid #bbb;">Â∞èË®à</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${cart.map(item => `
                            <tr>
                                <td>${item.name}</td>
                                <td style="text-align:right;">NT$${item.price}</td>
                                <td style="text-align:right;">${item.quantity}</td>
                                <td style="text-align:right;">NT$${item.price * item.quantity}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            document.getElementById('print-total').innerHTML = document.getElementById('total').outerHTML.replace('id="total"', '');
            document.getElementById('print-area').style.display = 'block';
            window.print();
            setTimeout(() => { document.getElementById('print-area').style.display = 'none'; }, 500);
            speak('ÂàóÂç∞ÊòéÁ¥∞ÂÆåÊàê');
        }
        function speak(text) {
            if (!speechOn) return;
            if ('speechSynthesis' in window) {
                const utter = new SpeechSynthesisUtterance(text);
                utter.lang = 'zh-TW';
                window.speechSynthesis.speak(utter);
            }
        }
        // ÂïÜÂìÅ Êñ∞Â¢û/Á∑®ËºØ/Âà™Èô§
        function showProductModal(editId=null) {
            editingProductId = editId;
            let modal = document.getElementById('modal');
            let modalBg = document.getElementById('modalBg');
            let prod = {name:"", price:"", stock:"", category:"È£≤ÂìÅ"};
            if (editId) {
                prod = products.find(p=>p.id===editId);
            }
            modal.innerHTML = `
                <h3>${editId ? 'Á∑®ËºØÂïÜÂìÅ' : 'Êñ∞Â¢ûÂïÜÂìÅ'}</h3>
                <form id="productForm" onsubmit="submitProductForm(event)">
                    <label>ÂêçÁ®±</label>
                    <input type="text" name="name" required value="${prod.name}">
                    <label>ÂÉπÊ†º (Êñ∞Âè∞Âπ£)</label>
                    <input type="number" name="price" required min="1" value="${prod.price}">
                    <label>Â∫´Â≠ò</label>
                    <input type="number" name="stock" required min="0" value="${prod.stock}">
                    <label>ÂàÜÈ°û</label>
                    <select name="category">
                        <option value="È£≤ÂìÅ" ${prod.category==='È£≤ÂìÅ'?'selected':''}>È£≤ÂìÅ</option>
                        <option value="ÁîúÈªû" ${prod.category==='ÁîúÈªû'?'selected':''}>ÁîúÈªû</option>
                        <option value="‰∏ªÈ£ü" ${prod.category==='‰∏ªÈ£ü'?'selected':''}>‰∏ªÈ£ü</option>
                        <option value="Â∞èÈ£ü" ${prod.category==='Â∞èÈ£ü'?'selected':''}>Â∞èÈ£ü</option>
                    </select>
                    <div class="modal-actions">
                        <button type="button" class="cancel-btn" onclick="closeModal()">ÂèñÊ∂à</button>
                        <button type="submit" class="ok-btn">${editId ? '‰øÆÊîπ' : 'Êñ∞Â¢û'}</button>
                    </div>
                </form>
            `;
            modalBg.style.display = "flex";
        }
        function submitProductForm(e){
            e.preventDefault();
            let modalBg = document.getElementById('modalBg');
            let f = e.target;
            let data = {
                name: f.name.value.trim(),
                price: parseInt(f.price.value),
                stock: parseInt(f.stock.value),
                category: f.category.value
            };
            if (!data.name || !data.price || data.price <= 0 || data.stock < 0) {
                alert('Ë´ãËº∏ÂÖ•ÊúâÊïàË≥áÊñô');
                return;
            }
            if (editingProductId) {
                let idx = products.findIndex(p=>p.id===editingProductId);
                products[idx] = {...products[idx], ...data};
                speak('ÂïÜÂìÅÂ∑≤‰øÆÊîπ');
            } else {
                let newId = products.length ? Math.max(...products.map(p=>p.id))+1 : 1;
                products.push({...data, id: newId});
                speak('ÂïÜÂìÅÂ∑≤Êñ∞Â¢û');
            }
            renderProducts(currentProductFilter, currentSearch);
            closeModal();
        }
        function closeModal() {
            document.getElementById('modalBg').style.display = "none";
            editingProductId = null;
        }
        function editProduct(id) {
            showProductModal(id);
        }
        function delProduct(id) {
            if(confirm("Á¢∫ÂÆöË¶ÅÂà™Èô§Ê≠§ÂïÜÂìÅÔºü")) {
                products = products.filter(p=>p.id!==id);
                speak('ÂïÜÂìÅÂ∑≤Âà™Èô§');
                renderProducts(currentProductFilter, currentSearch);
            }
        }
        // Ê¢ùÁ¢ºÂÅµÊ∏¨
        let barcodeBuffer = "";
        let barcodeTimer;
        document.addEventListener('keydown', function(e) {
            if (document.activeElement.tagName === 'INPUT') return;
            if ((e.key >= '0' && e.key <= '9') || e.key === '-') {
                barcodeBuffer += e.key;
                clearTimeout(barcodeTimer);
                barcodeTimer = setTimeout(() => {
                    if (barcodeBuffer.length >= 4) {
                        const product = products.find(p => p.id == barcodeBuffer || p.name.includes(barcodeBuffer));
                        if (product) {
                            addToCart(product.id);
                            speak('Ê¢ùÁ¢ºÂïÜÂìÅÂ∑≤Âä†ÂÖ•Ë≥ºÁâ©Ëªä');
                        } else {
                            speak('Êú™ÊâæÂà∞Ê¢ùÁ¢ºÂïÜÂìÅ');
                        }
                    }
                    barcodeBuffer = "";
                }, 300);
            }
        });
    </script>
</body>
</html>